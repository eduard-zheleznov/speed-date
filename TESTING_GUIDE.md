# Руководство по тестированию сервиса видео-знакомств

## Тестовые аккаунты

Созданы 3 тестовых пользователя с полностью заполненными профилями:

1. **Алиса** (alice@test.com / test123)
   - Возраст: 25, Женщина
   - Город: Москва
   - Ищет: Мужчин 25-35 лет

2. **Боб** (bob@test.com / test123)
   - Возраст: 28, Мужчина
   - Город: Москва
   - Ищет: Женщин 25-35 лет

3. **Мария** (maria@test.com / test123)
   - Возраст: 30, Женщина
   - Город: Москва
   - Ищет: Мужчин 25-35 лет

## Как протестировать функционал

### 1. Тестирование видеочата и симулятора

1. Войдите как **Боб** (bob@test.com / test123)
2. Перейдите в раздел "Видеочат"
3. Нажмите "Знакомиться" - система найдет Алису или Марию
4. Начнется видеочат с симулятором (1 минута для демонстрации)
5. Наблюдайте за таймером обратного отсчета
6. После окончания таймера появится модальное окно "Хотите продолжить общаться в чате?"

### 2. Тестирование создания чата (совпадения)

**Вариант А: Через видеосессию (требует 2 окна)**

1. Откройте 2 окна браузера
2. Окно 1: Войдите как Боб
3. Окно 2: Войдите как Алиса
4. В обоих окнах нажмите "Знакомиться" и дождитесь совпадения
5. Когда появится модальное окно, в обоих окнах нажмите "ДА"
6. Если оба согласны - откроется чат

**Вариант Б: Через демо-кнопку (быстрый способ)**

1. Войдите как Боб
2. В разделе "Видеочат" нажмите кнопку **"Создать демо-матч для тестирования"**
3. Система автоматически создаст совпадение с одним из тестовых пользователей
4. Вы будете перенаправлены в раздел "Чаты"
5. Откройте созданный чат и протестируйте переписку

### 3. Тестирование текстового чата

1. После создания совпадения (см. п.2)
2. Перейдите в раздел "Чаты" (вторая иконка в навигации)
3. Откройте созданный чат
4. Отправьте несколько сообщений
5. Обратите внимание на:
   - Счетчик "Чат удалится через X дней" (30 дней)
   - Кликабельный знак вопроса рядом со счетчиком (открывает информационное окно)
   - Отображение времени отправки
   - Разные цвета для своих/чужих сообщений
   - Фиксированный заголовок с кнопкой "Назад" для удобной навигации

### 4. Тестирование системы жалоб

1. Во время видеочата, когда появится модальное окно
2. Нажмите "НЕТ"
3. Откроется модальное окно жалобы
4. Можете указать причину или просто нажать "Отмена"
5. Если отправите жалобу - она попадет в админ-панель

### 5. Тестирование загрузки фото профиля

1. Войдите под любым аккаунтом
2. Перейдите в раздел "Профиль"
3. Нажмите кнопку "Редактировать"
4. В секции "Фото профиля" нажмите на блок "Загрузить"
5. Выберите изображение (до 3 фото)
6. После загрузки:
   - Наведите на фото чтобы увидеть кнопки
   - Можете удалить фото
   - Можете сделать любое фото главным (первое = аватар)

### 6. Тестирование подписок

1. Перейдите в раздел "Подписка"
2. Вы увидите:
   - Счетчик оставшихся бесплатных общений (5 в день)
   - Три тарифа: Серебро, Золото, VIP
3. Нажмите "ОПЛАТИТЬ" на любом тарифе
4. Система добавит дополнительные общения (**мокировано**, без реальной оплаты)
5. Счетчик обновится

### 7. Доступ к админ-панели

**Важно:** Доступ к админке имеют только пользователи с "admin" в email

Чтобы протестировать админку:

**Способ 1: Создать админа вручную**
```bash
# Зайдите в backend контейнер и создайте админа
cd /app/backend
python -c "
import asyncio
from motor.motor_asyncio import AsyncIOMotorClient
from auth import get_password_hash
from datetime import datetime, timezone
import os

async def create_admin():
    client = AsyncIOMotorClient(os.environ['MONGO_URL'])
    db = client[os.environ['DB_NAME']]
    
    admin = {
        'id': 'admin-user',
        'email': 'admin@test.com',
        'name': 'Администратор',
        'password_hash': get_password_hash('admin123'),
        'age': 30,
        'gender': 'male',
        'city': 'Moscow',
        'profile_completed': True,
        'blocked': False,
        'complaint_count': 0,
        'photos': [],
        'created_at': datetime.now(timezone.utc).isoformat()
    }
    
    await db.users.update_one({'id': 'admin-user'}, {'\$set': admin}, upsert=True)
    print('✓ Админ создан: admin@test.com / admin123')
    client.close()

asyncio.run(create_admin())
"
```

**Способ 2: Используйте тестового админа (если создан)**
- Email: admin@test.com
- Пароль: admin123

После входа:
1. Перейдите на `/admin` (https://datemeet-7.preview.emergentagent.com/admin)
2. Вы увидите 5 вкладок:
   - **Статистика**: общая статистика сервиса
   - **Пользователи**: список всех пользователей с датами регистрации/входа, сортировкой, поиском, возможностью блокировки и удаления
   - **Подписки**: активация подписок для пользователей, список пользователей с активными подписками
   - **Тарифы**: управление тарифами (включение/отключение)
   - **Жалобы**: все поданные жалобы

## Симулятор видеочата

Поскольку WebRTC требует настройки STUN/TURN серверов, реализован **симулятор видеочата**:

- Показывает анимированный интерфейс видеозвонка
- Отображает аватар собеседника
- Работает таймер обратного отсчета (1 минута для демо)
- Можно переключить в полноэкранный режим
- После окончания времени появляется модальное окно решения

## Что работает vs Что замокировано

### ✅ Полностью работает:
- Регистрация и аутентификация
- Заполнение и редактирование профиля
- Загрузка фото (до 3 шт, выбор главного)
- Система фильтров
- Поиск совпадений по взаимным критериям
- Таймер видеочата
- Модальные окна решений
- Текстовый чат с историей сообщений
- Система жалоб
- Подписки (добавление общений)
- Админ-панель (статистика, управление пользователями, жалобы)
- Навигация между разделами

### ⚠️ Замокировано:
- **Email отправка** - возвращает success, но письма не отправляются
- **ЮКassa оплата** - добавляет общения без реальной оплаты
- **WebRTC peer-to-peer** - используется симулятор вместо реального видео

## Полезные эндпоинты API

- `POST /api/testing/create-demo-match` - создать демо-совпадение для тестирования чатов
- `GET /api/admin/stats` - получить статистику (только для админов)
- `GET /api/admin/users` - список всех пользователей
- `GET /api/admin/complaints` - все жалобы

## Рекомендуемый порядок тестирования

1. **Зарегистрируйтесь** как новый пользователь
2. **Заполните профиль** (все обязательные поля)
3. **Установите фильтры** поиска
4. **Загрузите 2-3 фото** в профиле
5. **Попробуйте найти совпадение** (может не найтись если нет подходящих)
6. **Используйте кнопку "Создать демо-матч"** для быстрого тестирования чата
7. **Протестируйте текстовый чат**
8. **Посмотрите подписки** и "купите" тариф
9. **Войдите как админ** и проверьте админ-панель

## Известные ограничения

- Видео работает только как симулятор (нужны STUN/TURN серверы для реального p2p)
- Email не отправляются реально (можно подключить SendGrid/Resend)
- Оплата через ЮКассу не работает (нужны реальные ключи)
- Поиск совпадений работает только если есть взаимное соответствие фильтрам
